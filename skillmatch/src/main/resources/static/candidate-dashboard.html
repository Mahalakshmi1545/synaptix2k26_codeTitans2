<!DOCTYPE html>
<html>
<head>
    <title>Candidate Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
	<div id="notificationBox" class="alert alert-success d-none"></div>
<div class="container mt-5">
    <h3>My Profile</h3>

    <input type="hidden" id="id">

    <input type="text" id="name" class="form-control mb-2" placeholder="Name">
    <input type="text" id="email" class="form-control mb-2" disabled>
    <input type="text" id="phone" class="form-control mb-2" placeholder="Phone">
    <input type="text" id="location" class="form-control mb-2" placeholder="Location">
    <input type="text" id="skills" class="form-control mb-2" placeholder="Skills">
    <input type="number" id="experience" class="form-control mb-2" placeholder="Experience">

    <button class="btn btn-success w-100" onclick="save()">Save Changes</button>
</div>

<script>

const email = localStorage.getItem("candidateEmail");

if (!email) {
    window.location.href = "candidate-login.html";
}

fetch("/candidates/getByEmail/" + email)
.then(res => res.json())
.then(data => {
    document.getElementById("id").value = data.id;
    document.getElementById("name").value = data.name;
    document.getElementById("email").value = data.email;
    document.getElementById("phone").value = data.phone;
    document.getElementById("location").value = data.location;
    document.getElementById("skills").value = data.skills;
    document.getElementById("experience").value = data.experience;
	fetch("/projects/notifications/" + data.id)
	.then(res => res.json())
	.then(notifications => {

	    if (notifications.length > 0) {

	        let box = document.getElementById("notificationBox");
	        box.classList.remove("d-none");

	        let messages = notifications.map(n => n.message).join("<br>");
	        box.innerHTML = messages;
	    }

	});
});

function save() {

    const id = document.getElementById("id").value;

    const updated = {
        name: document.getElementById("name").value,
        email: email,
        phone: document.getElementById("phone").value,
        location: document.getElementById("location").value,
        skills: document.getElementById("skills").value,
        experience: parseInt(document.getElementById("experience").value)
    };

    fetch("/candidates/update/" + id, {
        method: "PUT",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(updated)
    })
    .then(res => res.text())
    .then(msg => alert(msg));
}

</script>

</body>
</html>